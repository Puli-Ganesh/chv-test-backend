datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  admin
  employee
}

enum Status {
  Win
  Lose
  Pending
}

model User {
  id            String   @id @default(uuid())            @map("id")
  username      String   @unique                         @map("username")
  passwordHash  String                                   @map("password_hash")
  role          Role                                     @map("role")
  createdAt     DateTime @default(now())                 @map("created_at")
  filesUploaded File[]    @relation("Uploader")
  filesAssigned File[]    @relation("Assignee")
  records       Record[]

  @@map("users")
}

model File {
  id           String   @id @default(uuid())             @map("id")
  filename     String                                   @map("filename")
  url          String                                   @map("url")
  uploadedBy   User     @relation("Uploader", fields: [uploadedById], references: [id])
  uploadedById String                                   @map("uploaded_by")
  assignedTo   User?    @relation("Assignee", fields: [assignedToId], references: [id])
  assignedToId String?                                  @map("assigned_to")
  createdAt    DateTime @default(now())                  @map("created_at")
  records      Record[]

  @@map("files")
}

model Record {
  id         String   @id @default(uuid())               @map("id")
  file       File     @relation(fields: [fileId], references: [id], onDelete: Cascade)
  fileId     String                                   @map("file_id")
  employee   User?    @relation(fields: [employeeId], references: [id])
  employeeId String?                                @map("employee_id")
  data       Json                                   @map("data")
  status     Status?                                @map("status")
  reason     String?                                @map("reason")
  updatedAt  DateTime @default(now())               @map("updated_at")
  createdAt  DateTime @default(now())               @map("created_at")

  @@map("records")
}
